let JS;
if (1) {
    JS = `{"size":15,"blank":[9,16,18,20,22,24,26,28,35,46,48,50,52,54,56,58,69,76,78,80,82,83,84,86,88,95,105,106,108,109,110,112,114,115,116,118,119,129,136,138,140,141,142,144,146,148,155,166,168,170,172,174,176,178,189,196,198,200,202,204,206,208,215],"numbers":{"0":1,"2":2,"4":3,"6":4,"8":5,"10":6,"12":7,"14":8,"30":9,"36":10,"60":11,"70":12,"90":13,"96":14,"98":15,"120":16,"124":17,"130":18,"134":19,"150":20,"156":21,"180":22,"190":23,"210":24,"216":25},"across":{"1":{"clue":"Removed-energy red germanium finds the very limit (5,4)","answer":"OUTEREDGE"},"6":{"clue":"Distribute unmuted shallots with root cut (5)","answer":"ALLOT"},"9":{"clue":"(Not odds) leave (not odds) Etna's (odds) (5)","answer":"EVENS"},"10":{"clue":"Levels debts and prepares to fight? (7,2)","answer":"SQUARESUP"},"11":{"clue":"Messily strip vines, tangle tangle! (9)","answer":"INELEGANT"},"12":{"clue":"Painless back-elbow after partial bite for book (5)","answer":"BIBLE"},"13":{"clue":"Understood to reverse after golf with extreme input (3,2)","answer":"GOTIT"},"14":{"clue":"Committed acid flowing back before primary titration indeed (9)","answer":"DEDICATED"},"16":{"clue":"Abandoned, deceased, around scared scrape (9)","answer":"DISCARDED"},"18":{"clue":"Audibly permitted audibly (5)","answer":"ALOUD"},"20":{"clue":"Monetary requirement around a beach (5)","answer":"COAST"},"21":{"clue":"Cocoa hill weirdly contains ethanol (9)","answer":"ALCOHOLIC"},"22":{"clue":"Dirty tide pipes to drink (4,5)","answer":"DIETPEPSI"},"23":{"clue":"Firing mode wizard pictured (5)","answer":"IMAGE"},"24":{"clue":"Terry messed up - give it another go (5)","answer":"RETRY"},"25":{"clue":"Commented sloppy data tonne (9)","answer":"ANNOTATED"}},"down":{"1":{"clue":"Allowing bogey in clumsily (7)","answer":"OBEYING"},"2":{"clue":"Bible division after initially evocative end of prayer, talking firstly about tango in west - the end of Christ? (3,3,9)","answer":"THENEWTESTAMENT"},"3":{"clue":"The most extreme fire results in extreme repayment (7)","answer":"RASHEST"},"4":{"clue":"Broken down, D = B + ED (9)","answer":"DISBANDED"},"5":{"clue":"Burst out with 'Are you inept?!' (5)","answer":"ERUPT"},"6":{"clue":"Endlessly bored in the CIA - back for free oxygen (7)","answer":"AEROBIC"},"7":{"clue":"Finally, stalls, eats awkwardly around loose button (4,3,3,5)","answer":"LASTBUTNOTLEAST"},"8":{"clue":"In Quito. Ps, EE doesn't rank number one (7)","answer":"TOPSEED"},"15":{"clue":"Top grade removed from education in extreme demolition inference (9)","answer":"DEDUCTION"},"16":{"clue":"'Decrypter Mammal' swallows fish (7)","answer":"DECODER"},"17":{"clue":"Desperately pays out for a post-mortem (7)","answer":"AUTOPSY"},"18":{"clue":"Non-believers at his tango conserve energy (7)","answer":"ATHEIST"},"19":{"clue":"Ordered curse to be odd indeed (7)","answer":"DECREED"},"21":{"clue":"Leader rushed a lap around hotel (5)","answer":"ALPHA"}},"ref":{"0":["1a","1d"],"1":["1a"],"2":["1a","2d"],"3":["1a"],"4":["1a","3d"],"5":["1a"],"6":["1a","4d"],"7":["1a"],"8":["1a","5d"],"15":["1d"],"30":["1d","9a"],"45":["1d"],"60":["1d","11a"],"75":["1d"],"90":["1d","13a"],"17":["2d"],"32":["2d","9a"],"47":["2d"],"62":["2d","11a"],"77":["2d"],"92":["2d","13a"],"107":["2d"],"122":["2d","16a"],"137":["2d"],"152":["2d","20a"],"167":["2d"],"182":["2d","22a"],"197":["2d"],"212":["2d","24a"],"19":["3d"],"34":["3d","9a"],"49":["3d"],"64":["3d","11a"],"79":["3d"],"94":["3d","13a"],"21":["4d"],"36":["4d","10a"],"51":["4d"],"66":["4d","11a"],"81":["4d"],"96":["4d","14a"],"111":["4d"],"126":["4d","16a"],"23":["5d"],"38":["5d","10a"],"53":["5d"],"68":["5d","11a"],"10":["6a","6d"],"11":["6a"],"12":["6a","7d"],"13":["6a"],"14":["6a","8d"],"25":["6d"],"40":["6d","10a"],"55":["6d"],"70":["6d","12a"],"85":["6d"],"100":["6d","14a"],"27":["7d"],"42":["7d","10a"],"57":["7d"],"72":["7d","12a"],"87":["7d"],"102":["7d","14a"],"117":["7d"],"132":["7d","18a"],"147":["7d"],"162":["7d","21a"],"177":["7d"],"192":["7d","23a"],"207":["7d"],"222":["7d","25a"],"29":["8d"],"44":["8d","10a"],"59":["8d"],"74":["8d","12a"],"89":["8d"],"104":["8d","14a"],"31":["9a"],"33":["9a"],"37":["10a"],"39":["10a"],"41":["10a"],"43":["10a"],"61":["11a"],"63":["11a"],"65":["11a"],"67":["11a"],"71":["12a"],"73":["12a"],"91":["13a"],"93":["13a"],"97":["14a"],"98":["14a","15d"],"99":["14a"],"101":["14a"],"103":["14a"],"113":["15d"],"128":["15d","16a"],"143":["15d"],"158":["15d","21a"],"173":["15d"],"188":["15d","22a"],"203":["15d"],"218":["15d","25a"],"120":["16a","16d"],"121":["16a"],"123":["16a"],"124":["16a","17d"],"125":["16a"],"127":["16a"],"135":["16d"],"150":["16d","20a"],"165":["16d"],"180":["16d","22a"],"195":["16d"],"210":["16d","24a"],"139":["17d"],"154":["17d","20a"],"169":["17d"],"184":["17d","22a"],"199":["17d"],"214":["17d","24a"],"130":["18a","18d"],"131":["18a"],"133":["18a"],"134":["18a","19d"],"145":["18d"],"160":["18d","21a"],"175":["18d"],"190":["18d","23a"],"205":["18d"],"220":["18d","25a"],"149":["19d"],"164":["19d","21a"],"179":["19d"],"194":["19d","23a"],"209":["19d"],"224":["19d","25a"],"151":["20a"],"153":["20a"],"156":["21a","21d"],"157":["21a"],"159":["21a"],"161":["21a"],"163":["21a"],"171":["21d"],"186":["21d","22a"],"201":["21d"],"216":["21d","25a"],"181":["22a"],"183":["22a"],"185":["22a"],"187":["22a"],"191":["23a"],"193":["23a"],"211":["24a"],"213":["24a"],"217":["25a"],"219":["25a"],"221":["25a"],"223":["25a"]}}`;
}

let clue_ends = {};
const TILE_SIZE = 32;

function load() {
    return JSON.parse(JS);
}

let board = load();
for (let [num, info] of Object.entries(board.across)) {
    add_clue(num, info.clue, "across");
    let or = get_origin(`${num}a`);
    let x = or[0] + info.answer.length - 1;
    let y = or[1];
    clue_ends[`${num}a`] = `${y * board.size + x};${x};${y}`;
}

for (let [num, info] of Object.entries(board.down)) {
    add_clue(num, info.clue, "down");
    let or = get_origin(`${num}d`);
    let x = or[0];
    let y = or[1] + info.answer.length - 1;
    clue_ends[`${num}d`] = `${y * board.size + x};${x};${y}`;
}

function get_origin(clue) {
    let num = clue.slice(0, clue.length - 1);
    for (let number of Object.keys(board.numbers)) {
        if (board.numbers[number] == num) return [number % board.size, Math.floor(number / board.size)];
    }
}

function create_board() {
    function create_square(x, y) {
        let i = y * board.size + x;

        let num;
        if (board.numbers[i]) num = board.numbers[i];
        
        
        if (board.blank.includes(i)) {
            let el = document.createElement("div");
            el.className = "blank";
            el.style.left = `${(x + 1) * TILE_SIZE}px`;
            el.style.top = `${(y + 1) * TILE_SIZE}px`;
            document.body.appendChild(el);
        } else {
            if (num) {
                let n = document.createElement("p");
                n.className = "number";
                n.style.left = `${(x + 1) * TILE_SIZE}px`;
                n.style.top = `${(y + 1) * TILE_SIZE}px`;
                n.innerText = num;
                document.body.appendChild(n);
            }

            let el = document.createElement("div");
            el.className = "square";
            el.style.left = `${(x + 1) * TILE_SIZE}px`;
            el.style.top = `${(y + 1) * TILE_SIZE}px`;
            el.id = `${i};${x};${y}`;

            if (x == 0) el.classList.add("left_exposed");
            if (y == 0) el.classList.add("top_exposed");

            document.body.appendChild(el);
        }
    }

    for (y = 0; y < board.size; y++) {
        for (x = 0; x < board.size; x++) {
            create_square(x, y);
        }
    }
}

create_board();
main();

function add_clue(num, clue, dir) {
    let li = document.createElement("li");
    li.className = "clue";
    li.id = `${num}${dir.charAt(0)}`;
    li.innerText = `${num}: ${clue}`;
    li.onclick = ev => {
        let e = ev.target;
        let n = e.id.slice(0, e.id.length - 1);
        let d = e.id.charAt(e.id.length - 1);

        let dir = d == "d" ? "down" : "across";
        let [x, y] = get_origin(`${n}${d}`);

        selected = document.getElementById(`${y * board.size + x};${x};${y}`);
        selected_dir = d;
        update_selection();
    }
    
    document.getElementById(dir).appendChild(li);
}
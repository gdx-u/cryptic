let JS;
if (1) {
    JS = `{"size":15,"blank":[9,16,18,20,22,24,26,28,35,46,48,50,51,52,54,56,58,67,75,76,78,80,82,84,85,86,88,99,106,107,108,110,111,112,113,114,116,117,118,125,136,138,139,140,142,144,146,148,149,157,166,168,170,172,173,174,176,178,189,196,198,200,202,204,206,208,215],"numbers":{"0":1,"2":2,"4":3,"6":4,"8":5,"10":6,"12":7,"14":8,"30":9,"36":10,"60":11,"66":12,"68":13,"90":14,"100":15,"120":16,"122":17,"126":18,"128":19,"132":20,"150":21,"154":22,"158":23,"164":24,"180":25,"188":26,"190":27,"210":28,"216":29},"across":{"1":{"clue":"Choice surrounding age surgery (9)","answer":"OPERATION"},"6":{"clue":"Trump's odds after power behave strangely (3,2)","answer":"ACTUP"},"9":{"clue":"Precise demand? (5)","answer":"EXACT"},"10":{"clue":"Exist around half-trembled fanatic (9)","answer":"EXTREMIST"},"11":{"clue":"Writes half-authentic or initially stolen (7)","answer":"AUTHORS"},"13":{"clue":"Code rat's messy type of decorative style (3,4)","answer":"ARTDECO"},"14":{"clue":"Electromagnetic oven? (9)","answer":"MICROWAVE"},"15":{"clue":"Pointless tan with 14 pounds to name, at the end it's preference (5)","answer":"TASTE"},"16":{"clue":"Sat back before the day ends saying yum (5)","answer":"TASTY"},"18":{"clue":"Grave mum around gold single (9)","answer":"MAUSOLEUM"},"21":{"clue":"Relent a messy immortal (7)","answer":"ETERNAL"},"23":{"clue":"Floating hairstyle? (7)","answer":"BOBBING"},"25":{"clue":"Incorporate messed up gene trait (9)","answer":"INTEGRATE"},"27":{"clue":"Saying I'm surround sound, scrap the gold (5)","answer":"IDIOM"},"28":{"clue":"Blow around egghead visitor (5)","answer":"GUEST"},"29":{"clue":"Half-leniency around mix issue (9)","answer":"EMERGENCY"}},"down":{"1":{"clue":"Pope's heart age drama (5)","answer":"OPERA"},"2":{"clue":"Rubbery upsale leads to 100 going after titanium (7)","answer":"ELASTIC"},"3":{"clue":"Many roots complex for the study of planets (9)","answer":"ASTRONOMY"},"4":{"clue":"'Freeze!' - US law enforcement agency? (3)","answer":"ICE"},"5":{"clue":"Housing comes after chest or hazel for wackjob (7)","answer":"NUTCASE"},"6":{"clue":"One male spy (5)","answer":"AGENT"},"7":{"clue":"Bathroom texts are heartless, filled with grease (7)","answer":"TOILETS"},"8":{"clue":"Peru motel messed up oil (9)","answer":"PETROLEUM"},"12":{"clue":"Charlie audibly goes to body of water (3)","answer":"SEA"},"14":{"clue":"Meaning from dull paint over olympic logo (9)","answer":"MATTERING"},"15":{"clue":"Fish's endless jewelry is worrying (9)","answer":"TROUBLING"},"17":{"clue":"She wraps around warmth to cover (7)","answer":"SHEATHE"},"18":{"clue":"Virus discovered inside of animal warehouse (7)","answer":"MALWARE"},"19":{"clue":"Drive the solver to last ruler's tomb (3, abbr.)","answer":"USB"},"20":{"clue":"Raised tide leads to charged particle release (7)","answer":"EDITION"},"22":{"clue":"We hear medieval warrior for the dark (5)","answer":"NIGHT"},"24":{"clue":"Sticky rip in redhead from gin rummy (5)","answer":"GUMMY"},"26":{"clue":"Tonight, victor's in service provider (3)","answer":"EVE"}},"ref":{"0":["1a","1d"],"1":["1a"],"2":["1a","2d"],"3":["1a"],"4":["1a","3d"],"5":["1a"],"6":["1a","4d"],"7":["1a"],"8":["1a","5d"],"15":["1d"],"30":["1d","9a"],"45":["1d"],"60":["1d","11a"],"17":["2d"],"32":["2d","9a"],"47":["2d"],"62":["2d","11a"],"77":["2d"],"92":["2d","14a"],"19":["3d"],"34":["3d","9a"],"49":["3d"],"64":["3d","11a"],"79":["3d"],"94":["3d","14a"],"109":["3d"],"124":["3d","16a"],"21":["4d"],"36":["4d","10a"],"23":["5d"],"38":["5d","10a"],"53":["5d"],"68":["5d","13a"],"83":["5d"],"98":["5d","14a"],"10":["6a","6d"],"11":["6a"],"12":["6a","7d"],"13":["6a"],"14":["6a","8d"],"25":["6d"],"40":["6d","10a"],"55":["6d"],"70":["6d","13a"],"27":["7d"],"42":["7d","10a"],"57":["7d"],"72":["7d","13a"],"87":["7d"],"102":["7d","15a"],"29":["8d"],"44":["8d","10a"],"59":["8d"],"74":["8d","13a"],"89":["8d"],"104":["8d","15a"],"119":["8d"],"134":["8d","18a"],"31":["9a"],"33":["9a"],"37":["10a"],"39":["10a"],"41":["10a"],"43":["10a"],"61":["11a"],"63":["11a"],"65":["11a"],"66":["11a","12d"],"81":["12d"],"96":["12d","14a"],"69":["13a"],"71":["13a"],"73":["13a"],"90":["14a","14d"],"91":["14a"],"93":["14a"],"95":["14a"],"97":["14a"],"105":["14d"],"120":["14d","16a"],"135":["14d"],"150":["14d","21a"],"165":["14d"],"180":["14d","25a"],"195":["14d"],"210":["14d","28a"],"100":["15a","15d"],"101":["15a"],"103":["15a"],"115":["15d"],"130":["15d","18a"],"145":["15d"],"160":["15d","23a"],"175":["15d"],"190":["15d","27a"],"205":["15d"],"220":["15d","29a"],"121":["16a"],"122":["16a","17d"],"123":["16a"],"137":["17d"],"152":["17d","21a"],"167":["17d"],"182":["17d","25a"],"197":["17d"],"212":["17d","28a"],"126":["18a","18d"],"127":["18a"],"128":["18a","19d"],"129":["18a"],"131":["18a"],"132":["18a","20d"],"133":["18a"],"141":["18d"],"156":["18d","21a"],"171":["18d"],"186":["18d","25a"],"201":["18d"],"216":["18d","29a"],"143":["19d"],"158":["19d","23a"],"147":["20d"],"162":["20d","23a"],"177":["20d"],"192":["20d","27a"],"207":["20d"],"222":["20d","29a"],"151":["21a"],"153":["21a"],"154":["21a","22d"],"155":["21a"],"169":["22d"],"184":["22d","25a"],"199":["22d"],"214":["22d","28a"],"159":["23a"],"161":["23a"],"163":["23a"],"164":["23a","24d"],"179":["24d"],"194":["24d","27a"],"209":["24d"],"224":["24d","29a"],"181":["25a"],"183":["25a"],"185":["25a"],"187":["25a"],"188":["25a","26d"],"203":["26d"],"218":["26d","29a"],"191":["27a"],"193":["27a"],"211":["28a"],"213":["28a"],"217":["29a"],"219":["29a"],"221":["29a"],"223":["29a"]}}`;
}

let clue_ends = {};
const TILE_SIZE = 32;

function load() {
    return JSON.parse(JS);
}

let board = load();
for (let [num, info] of Object.entries(board.across)) {
    add_clue(num, info.clue, "across");
    let or = get_origin(`${num}a`);
    let x = or[0] + info.answer.length - 1;
    let y = or[1];
    clue_ends[`${num}a`] = `${y * board.size + x};${x};${y}`;
}

for (let [num, info] of Object.entries(board.down)) {
    add_clue(num, info.clue, "down");
    let or = get_origin(`${num}d`);
    let x = or[0];
    let y = or[1] + info.answer.length - 1;
    clue_ends[`${num}d`] = `${y * board.size + x};${x};${y}`;
}

function get_origin(clue) {
    let num = clue.slice(0, clue.length - 1);
    for (let number of Object.keys(board.numbers)) {
        if (board.numbers[number] == num) return [number % board.size, Math.floor(number / board.size)];
    }
}

function create_board() {
    function create_square(x, y) {
        let i = y * board.size + x;

        let num;
        if (board.numbers[i]) num = board.numbers[i];
        
        
        if (board.blank.includes(i)) {
            let el = document.createElement("div");
            el.className = "blank";
            el.style.left = `${(x + 1) * TILE_SIZE}px`;
            el.style.top = `${(y + 1) * TILE_SIZE}px`;
            document.body.appendChild(el);
        } else {
            if (num) {
                let n = document.createElement("p");
                n.className = "number";
                n.style.left = `${(x + 1) * TILE_SIZE}px`;
                n.style.top = `${(y + 1) * TILE_SIZE}px`;
                n.innerText = num;
                document.body.appendChild(n);
            }

            let el = document.createElement("div");
            el.className = "square";
            el.style.left = `${(x + 1) * TILE_SIZE}px`;
            el.style.top = `${(y + 1) * TILE_SIZE}px`;
            el.id = `${i};${x};${y}`;

            if (x == 0) el.classList.add("left_exposed");
            if (y == 0) el.classList.add("top_exposed");

            document.body.appendChild(el);
        }
    }

    for (y = 0; y < board.size; y++) {
        for (x = 0; x < board.size; x++) {
            create_square(x, y);
        }
    }
}

create_board();
main();

function add_clue(num, clue, dir) {
    let li = document.createElement("li");
    li.className = "clue";
    li.id = `${num}${dir.charAt(0)}`;
    li.innerText = `${num}: ${clue}`;
    li.onclick = ev => {
        let e = ev.target;
        let n = e.id.slice(0, e.id.length - 1);
        let d = e.id.charAt(e.id.length - 1);

        let dir = d == "d" ? "down" : "across";
        let [x, y] = get_origin(`${n}${d}`);

        selected = document.getElementById(`${y * board.size + x};${x};${y}`);
        selected_dir = d;
        update_selection();
    }
    
    document.getElementById(dir).appendChild(li);
}
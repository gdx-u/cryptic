let JS;
if (1) {
    JS = `{"size":15,"blank":[9,16,18,20,22,24,26,28,35,46,48,50,52,53,54,56,58,69,76,77,78,80,81,82,84,86,88,89,95,106,108,109,110,112,114,115,116,118,129,135,136,138,140,142,143,144,146,147,148,155,166,168,170,171,172,174,176,178,189,196,198,200,202,204,206,208,215],"numbers":{"0":1,"2":2,"4":3,"6":4,"8":5,"10":6,"12":7,"14":8,"30":9,"36":10,"60":11,"68":12,"70":13,"90":14,"92":15,"96":16,"104":17,"120":18,"124":19,"130":20,"150":21,"156":22,"158":23,"162":24,"180":25,"186":26,"190":27,"210":28,"216":29},"across":{"1":{"clue":"Head-regenerating monster initially uses lead ingrained city water pipes (9)","answer":"HYDRAULIC"},"6":{"clue":"Located fourth lbttbr (5)","answer":"BASED"},"9":{"clue":"Intensifier when initially unfazed leftist gets art messed up (5)","answer":"ULTRA"},"10":{"clue":"Media prep ruined delusion (4,5)","answer":"PIPEDREAM"},"11":{"clue":"Risks finish, infuriates (9)","answer":"ENDANGERS"},"13":{"clue":"When done, find conclusion (3,2)","answer":"ENDON"},"14":{"clue":"Conqueror bitterly hides ring (5)","answer":"ORBIT"},"16":{"clue":"Goals charged in morning stuff (9)","answer":"AMBITIONS"},"18":{"clue":"Toe around the french, prance naked to patience (9)","answer":"TOLERANCE"},"20":{"clue":"Acdefghijklmnopqr entertainer (5)","answer":"ACTOR"},"21":{"clue":"Bar destroyed following cobalt snake (5)","answer":"COBRA"},"22":{"clue":"Wooden blocks sharpen after axes pointlessly slope (9)","answer":"XYLOPHONE"},"25":{"clue":"Gratuity is unsheathing cleaver and returning flatbread (5,1,3)","answer":"LEAVEATIP"},"27":{"clue":"Energy in religious studies about operating system blossoms (5)","answer":"ROSES"},"28":{"clue":"Allied, Sierra gets asked for identification (colloquially) (5)","answer":"SIDED"},"29":{"clue":"Taker rise: awkwardly (9)","answer":"COLONISER"}},"down":{"1":{"clue":"Find value in homeless @ liveaboard (9)","answer":"HOUSEBOAT"},"2":{"clue":"Old and loved? (5)","answer":"DATED"},"3":{"clue":"Unwilling decapitating past revolves around profit (7)","answer":"AGAINST"},"4":{"clue":"Afterword in non-lane error (5)","answer":"LAPSE"},"5":{"clue":"Glass uranium found in, to start, cheese pizza (3)","answer":"CUP"},"6":{"clue":"Worst and most attractive? (7)","answer":"BADDEST"},"7":{"clue":"Sierra backs up deep at first, before ordering a tiny motorboat (9)","answer":"SPEEDBOAT"},"8":{"clue":"Devil goth in damnation's edge (5)","answer":"DEMON"},"12":{"clue":"Sierra - a half-brown energy blade (5)","answer":"SABRE"},"15":{"clue":"Famous bullet makes contact with council sign (9)","answer":"BILLBOARD"},"16":{"clue":"We hear a past lover gain territory (5)","answer":"ANNEX"},"17":{"clue":"Sandwiched right between two men, affirmative! (3,3,3)","answer":"SIRYESSIR"},"19":{"clue":"Render a messy back hit (4,3)","answer":"REAREND"},"20":{"clue":"Revolve around wrong reference intake after a headache pill (7)","answer":"ASPIRIN"},"21":{"clue":"Computer science revolves around lecturer's #1 in the morning lulls (5)","answer":"CALMS"},"23":{"clue":"Jacket fold monkey finds itself in 50/50 (5)","answer":"LAPEL"},"24":{"clue":"Lake strips boat, with ships odds (5)","answer":"OASIS"},"26":{"clue":"Take this place from heretic muscle contraction (3)","answer":"TIC"}},"ref":{"0":["1a","1d"],"1":["1a"],"2":["1a","2d"],"3":["1a"],"4":["1a","3d"],"5":["1a"],"6":["1a","4d"],"7":["1a"],"8":["1a","5d"],"15":["1d"],"30":["1d","9a"],"45":["1d"],"60":["1d","11a"],"75":["1d"],"90":["1d","14a"],"105":["1d"],"120":["1d","18a"],"17":["2d"],"32":["2d","9a"],"47":["2d"],"62":["2d","11a"],"19":["3d"],"34":["3d","9a"],"49":["3d"],"64":["3d","11a"],"79":["3d"],"94":["3d","14a"],"21":["4d"],"36":["4d","10a"],"51":["4d"],"66":["4d","11a"],"23":["5d"],"38":["5d","10a"],"10":["6a","6d"],"11":["6a"],"12":["6a","7d"],"13":["6a"],"14":["6a","8d"],"25":["6d"],"40":["6d","10a"],"55":["6d"],"70":["6d","13a"],"85":["6d"],"100":["6d","16a"],"27":["7d"],"42":["7d","10a"],"57":["7d"],"72":["7d","13a"],"87":["7d"],"102":["7d","16a"],"117":["7d"],"132":["7d","20a"],"29":["8d"],"44":["8d","10a"],"59":["8d"],"74":["8d","13a"],"31":["9a"],"33":["9a"],"37":["10a"],"39":["10a"],"41":["10a"],"43":["10a"],"61":["11a"],"63":["11a"],"65":["11a"],"67":["11a"],"68":["11a","12d"],"83":["12d"],"98":["12d","16a"],"113":["12d"],"128":["12d","18a"],"71":["13a"],"73":["13a"],"91":["14a"],"92":["14a","15d"],"93":["14a"],"107":["15d"],"122":["15d","18a"],"137":["15d"],"152":["15d","21a"],"167":["15d"],"182":["15d","25a"],"197":["15d"],"212":["15d","28a"],"96":["16a","16d"],"97":["16a"],"99":["16a"],"101":["16a"],"103":["16a"],"104":["16a","17d"],"111":["16d"],"126":["16d","18a"],"141":["16d"],"156":["16d","22a"],"119":["17d"],"134":["17d","20a"],"149":["17d"],"164":["17d","22a"],"179":["17d"],"194":["17d","27a"],"209":["17d"],"224":["17d","29a"],"121":["18a"],"123":["18a"],"124":["18a","19d"],"125":["18a"],"127":["18a"],"139":["19d"],"154":["19d","21a"],"169":["19d"],"184":["19d","25a"],"199":["19d"],"214":["19d","28a"],"130":["20a","20d"],"131":["20a"],"133":["20a"],"145":["20d"],"160":["20d","22a"],"175":["20d"],"190":["20d","27a"],"205":["20d"],"220":["20d","29a"],"150":["21a","21d"],"151":["21a"],"153":["21a"],"165":["21d"],"180":["21d","25a"],"195":["21d"],"210":["21d","28a"],"157":["22a"],"158":["22a","23d"],"159":["22a"],"161":["22a"],"162":["22a","24d"],"163":["22a"],"173":["23d"],"188":["23d","25a"],"203":["23d"],"218":["23d","29a"],"177":["24d"],"192":["24d","27a"],"207":["24d"],"222":["24d","29a"],"181":["25a"],"183":["25a"],"185":["25a"],"186":["25a","26d"],"187":["25a"],"201":["26d"],"216":["26d","29a"],"191":["27a"],"193":["27a"],"211":["28a"],"213":["28a"],"217":["29a"],"219":["29a"],"221":["29a"],"223":["29a"]}}`;
}

let clue_ends = {};
const TILE_SIZE = 32;

function load() {
    return JSON.parse(JS);
}

let board = load();
for (let [num, info] of Object.entries(board.across)) {
    add_clue(num, info.clue, "across");
    let or = get_origin(`${num}a`);
    let x = or[0] + info.answer.length - 1;
    let y = or[1];
    clue_ends[`${num}a`] = `${y * board.size + x};${x};${y}`;
}

for (let [num, info] of Object.entries(board.down)) {
    add_clue(num, info.clue, "down");
    let or = get_origin(`${num}d`);
    let x = or[0];
    let y = or[1] + info.answer.length - 1;
    clue_ends[`${num}d`] = `${y * board.size + x};${x};${y}`;
}

function get_origin(clue) {
    let num = clue.slice(0, clue.length - 1);
    for (let number of Object.keys(board.numbers)) {
        if (board.numbers[number] == num) return [number % board.size, Math.floor(number / board.size)];
    }
}

function create_board() {
    function create_square(x, y) {
        let i = y * board.size + x;

        let num;
        if (board.numbers[i]) num = board.numbers[i];
        
        
        if (board.blank.includes(i)) {
            let el = document.createElement("div");
            el.className = "blank";
            el.style.left = `${(x + 1) * TILE_SIZE}px`;
            el.style.top = `${(y + 1) * TILE_SIZE}px`;
            document.body.appendChild(el);
        } else {
            if (num) {
                let n = document.createElement("p");
                n.className = "number";
                n.style.left = `${(x + 1) * TILE_SIZE}px`;
                n.style.top = `${(y + 1) * TILE_SIZE}px`;
                n.innerText = num;
                document.body.appendChild(n);
            }

            let el = document.createElement("div");
            el.className = "square";
            el.style.left = `${(x + 1) * TILE_SIZE}px`;
            el.style.top = `${(y + 1) * TILE_SIZE}px`;
            el.id = `${i};${x};${y}`;

            if (x == 0) el.classList.add("left_exposed");
            if (y == 0) el.classList.add("top_exposed");

            document.body.appendChild(el);
        }
    }

    for (y = 0; y < board.size; y++) {
        for (x = 0; x < board.size; x++) {
            create_square(x, y);
        }
    }
}

create_board();
main();

function add_clue(num, clue, dir) {
    let li = document.createElement("li");
    li.className = "clue";
    li.id = `${num}${dir.charAt(0)}`;
    li.innerText = `${num}: ${clue}`;
    li.onclick = ev => {
        let e = ev.target;
        let n = e.id.slice(0, e.id.length - 1);
        let d = e.id.charAt(e.id.length - 1);

        let dir = d == "d" ? "down" : "across";
        let [x, y] = get_origin(`${n}${d}`);

        selected = document.getElementById(`${y * board.size + x};${x};${y}`);
        selected_dir = d;
        update_selection();
    }
    
    document.getElementById(dir).appendChild(li);

}
